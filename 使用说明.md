# FAB50 硬件监控系统 - 使用说明

## 功能特性

### 🎯 主要功能
- **硬件信息收集**: 收集CPU、内存、磁盘、网络、操作系统信息
- **数据保存**: 服务器接收数据后自动保存到指定目录的JSON文件
- **客户端自删除**: 服务器通知客户端停止并自删除
- **实时监控**: WebSocket实时推送数据到Web界面
- **现代化界面**: 响应式设计，支持移动设备

### 🔄 工作流程
1. 客户端收集硬件信息
2. 发送数据到服务器
3. 服务器保存数据到文件
4. 服务器通知客户端停止并自删除
5. 客户端收到通知后退出并删除自己

## 快速开始

### 1. 启动服务器
```bash
# 使用默认参数
go run cmd/server/main.go

# 或指定参数
go run cmd/server/main.go -port 8080 -data-dir ./data -max-hosts 50
```

**服务器参数说明:**
- `-port`: 服务器端口 (默认: 8080)
- `-data-dir`: 数据保存目录 (默认: ./data)
- `-max-hosts`: 最大主机数量 (默认: 100)
- `-max-records`: 每个主机最大记录数 (默认: 1000)

### 2. 启动客户端
```bash
# 使用默认参数
go run cmd/client/main.go

# 或指定参数
go run cmd/client/main.go -server http://localhost:8080 -interval 30s
```

**客户端参数说明:**
- `-server`: 服务器地址 (默认: http://localhost:8080)
- `-interval`: 收集间隔 (默认: 30s)

### 3. 访问Web界面
打开浏览器访问：http://localhost:8080

## 数据保存

### 数据文件结构
服务器会将每个主机的数据保存为独立的JSON文件：

```
data/
├── hostname1.json
├── hostname2.json
└── hostname3.json
```

### 数据文件格式
```json
{
  "hostname": "主机名",
  "last_update": "2024-01-01T12:00:00Z",
  "hardware_info": [
    {
      "hostname": "主机名",
      "timestamp": "2024-01-01T12:00:00Z",
      "cpu": {
        "usage": 25.5,
        "cores": 8,
        "model_name": "Intel Core i7"
      },
      "memory": {
        "total": 17179869184,
        "used": 8589934592,
        "free": 8589934592,
        "usage": 50.0
      },
      "disk": {
        "partitions": [
          {
            "device": "C:",
            "mount_point": "C:\\",
            "total": 256060514304,
            "used": 128030257152,
            "free": 128030257152,
            "usage": 50.0
          }
        ]
      },
      "network": {
        "interfaces": [
          {
            "name": "以太网",
            "addresses": ["192.168.1.100"],
            "bytes_sent": 1024,
            "bytes_recv": 2048,
            "packets_sent": 10,
            "packets_recv": 20
          }
        ]
      },
      "os": {
        "name": "Windows",
        "version": "10.0.19045",
        "architecture": "amd64",
        "platform": "windows"
      }
    }
  ],
  "max_records": 100
}
```

## 监控的硬件信息

### CPU信息
- 使用率 (%)
- 核心数
- 型号名称
- 频率 (如果支持)

### 内存信息
- 总内存 (字节)
- 已使用内存 (字节)
- 可用内存 (字节)
- 使用率 (%)
- 交换内存信息

### 磁盘信息
- 分区设备名
- 挂载点
- 总容量 (字节)
- 已使用空间 (字节)
- 可用空间 (字节)
- 使用率 (%)

### 网络信息
- 网络接口名称
- IP地址列表
- 发送字节数
- 接收字节数
- 发送包数
- 接收包数

### 操作系统信息
- 操作系统名称
- 版本
- 架构
- 平台

## 客户端自删除机制

### 工作流程
1. 客户端发送硬件信息到服务器
2. 服务器接收数据并保存到文件
3. 服务器返回响应，包含 `action: "stop_and_delete"`
4. 客户端解析响应，发现需要自删除
5. 客户端创建批处理文件来删除自己
6. 客户端退出程序
7. 批处理文件在2秒后删除客户端可执行文件

### 安全特性
- 客户端只在收到服务器明确通知后才自删除
- 使用批处理文件确保在程序退出后删除文件
- 支持Windows系统

## 故障排除

### 常见问题

1. **服务器无法启动**
   - 检查端口是否被占用
   - 确认有足够的权限创建数据目录

2. **客户端无法连接**
   - 检查服务器地址和端口是否正确
   - 确认防火墙设置
   - 检查网络连接

3. **数据文件未生成**
   - 检查数据目录权限
   - 确认服务器有写入权限

4. **客户端未自删除**
   - 检查服务器响应是否包含正确的action字段
   - 确认客户端有权限创建和执行批处理文件

### 日志查看
服务器和客户端都会输出详细的日志信息：
- 服务器日志：显示数据接收和保存状态
- 客户端日志：显示数据收集和发送状态

## 技术特性

- **Go语言**: 高性能、跨平台
- **gopsutil**: 硬件信息收集
- **Gin**: Web框架
- **WebSocket**: 实时通信
- **本地CSS/JS**: 不依赖外部资源
- **JSON存储**: 结构化数据保存

## 系统要求

- Go 1.21 或更高版本
- 支持的操作系统: Windows, Linux, macOS
- 现代浏览器（支持WebSocket）

## 注意事项

- 本系统仅用于监控目的，请确保在合法和授权的环境中使用
- 客户端自删除功能会永久删除客户端程序文件
- 建议在生产环境中配置适当的安全措施
- 定期备份重要的监控数据
